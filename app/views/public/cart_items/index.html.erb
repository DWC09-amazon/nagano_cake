<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="h3 d-inline-block p-2 bg-light border border-secondary mb-0">ショッピングカート</h2>
    
    <%= link_to 'カートを空にする', destroy_all_cart_items_path, method: :delete, 
                class: 'btn btn-danger', data: { confirm: '本当にカートを空にしますか？' } %>
  </div>

  <table class="table table-bordered">
    <thead class="thead-light">
      <tr>
        <th style="width: 10%;"></th> 
        <th style="width: 35%;">商品名</th>
        <th style="width: 15%;">単価(税込)</th>
        <th style="width: 15%;">数量</th>
        <th style="width: 15%;">小計</th>
        <th style="width: 10%;"></th> 
      </tr>
    </thead>
    <tbody>
      <% @cart_items.each do |cart_item| %>
        <tr>
          <td><%= image_tag cart_item.item.get_item_image(50, 50), size: "50x50" %></td> 
          <td><%= cart_item.item.name %></td>
          <td><%= cart_item.item.tax_included_price.to_s(:delimited) %></td>
          
          <td>
            <%= form_with model: cart_item, url: cart_item_path(cart_item), method: :patch, local: true do |f| %>
              <div class="d-flex align-items-center">
                <%= f.select :amount, (1..10).to_a, selected: cart_item.amount, class: 'form-control mr-2' %>
                <%= f.submit '変更', class: 'btn btn-success btn-sm' %>
                <%= f.hidden_field :item_id, value: cart_item.item_id %>
              </div>
            <% end %>
          </td>
          
          <td><%= cart_item.subtotal.to_s(:delimited) %></td>
          
          <td>
            <%= link_to '削除する', cart_item_path(cart_item), method: :delete, 
                        class: 'btn btn-danger btn-sm', data: { confirm: 'この商品を削除しますか？' } %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

 <div class="d-flex justify-content-between mt-4">
    <div>
        <%= link_to '買い物を続ける', root_path, class: 'btn btn-primary' %>
    </div>
    
    <div class="w-50">
        <table class="table table-bordered mb-0">
            <tr>
                <th class="bg-light" style="width: 50%;">合計金額</th>
                <td class="text-right">
                    <%= @total_price.to_s(:delimited) %>
                </td>
            </tr>
        </table>
        
        <div class="text-center mt-5">
            <%= link_to '情報入力に進む', new_order_path, class: 'btn btn-success btn-lg' %>
        </div>
    </div>
    </div>